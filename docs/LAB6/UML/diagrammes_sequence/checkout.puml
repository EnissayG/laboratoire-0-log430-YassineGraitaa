@startuml
title Diagramme de séquence – Saga orchestrée : checkout réussi

actor Client
participant "orchestrateur-service\n(commande_orchestration.py)" as Orchestrateur
participant "panier-service" as Panier
participant "stock-service" as Stock
participant "client-service" as ClientS
participant "ventes-service" as Ventes
database "PostgreSQL\norchestrateur-db" as DB

Client -> Orchestrateur : POST /api/commande/checkout
activate Orchestrateur

Orchestrateur -> DB : Créer Commande + état INITIÉE
Orchestrateur -> Panier : GET /paniers/client/{id}
Panier --> Orchestrateur : [produits]

Orchestrateur -> Stock : POST /stock/reserver
Stock --> Orchestrateur : 200 OK
Orchestrateur -> DB : Log état STOCK_RÉSERVÉ

Orchestrateur -> ClientS : POST /clients/{id}/payer
ClientS --> Orchestrateur : 200 OK
Orchestrateur -> DB : Log état PAIEMENT_EFFECTUÉ

Orchestrateur -> Ventes : POST /ventes
Ventes --> Orchestrateur : 201 Created
Orchestrateur -> DB : Log état CONFIRMÉE

Orchestrateur --> Client : {saga_id, état_final: CONFIRMÉE}
deactivate Orchestrateur
@enduml
